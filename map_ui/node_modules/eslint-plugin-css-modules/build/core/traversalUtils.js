'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.eliminateGlobals = exports.getExtendClassesMap = exports.getComposesClassesMap = exports.getRegularClassesMap = undefined;

var _fp = require('lodash/fp');

var _fp2 = _interopRequireDefault(_fp);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var getRegularClassesMap = exports.getRegularClassesMap = function getRegularClassesMap(ast) {
  var ruleSets = [];
  ast.traverseByType('ruleset', function (node) {
    return ruleSets.push(node);
  });

  return _fp2.default.compose(_fp2.default.reduce(function (result, key) {
    result[key] = false; // classes haven't been used
    return result;
  }, {}), _fp2.default.map('content'), _fp2.default.filter({ type: 'ident' }), _fp2.default.flatMap('content'), _fp2.default.filter({ type: 'class' }), _fp2.default.flatMap('content'), _fp2.default.filter({ type: 'selector' }), _fp2.default.flatMap('content'))(ruleSets);
};
/* eslint-disable no-param-reassign */
var getComposesClassesMap = exports.getComposesClassesMap = function getComposesClassesMap(ast) {
  var declarations = [];
  ast.traverseByType('declaration', function (node) {
    return declarations.push(node);
  });

  return _fp2.default.compose(_fp2.default.reduce(function (result, key) {
    result[key] = true; // mark composed classes as true
    return result;
  }, {}), _fp2.default.flatMap(_fp2.default.compose(_fp2.default.map(_fp2.default.get('content')), _fp2.default.filter({ type: 'ident' }), _fp2.default.get('content'), _fp2.default.find({ type: 'value' }), _fp2.default.get('content'))),
  /*
     reject classes composing from other files
     eg.
     .foo {
     composes: .bar from './otherFile';
     }
   */
  _fp2.default.reject(_fp2.default.compose(_fp2.default.find({ type: 'ident', content: 'from' }), _fp2.default.get('content'), _fp2.default.find({ type: 'value' }), _fp2.default.get('content'))), _fp2.default.filter(_fp2.default.compose(_fp2.default.find({ type: 'ident', content: 'composes' }), _fp2.default.get('content'), _fp2.default.find({ type: 'property' }), _fp2.default.get('content'))))(declarations);
};

var getExtendClassesMap = exports.getExtendClassesMap = function getExtendClassesMap(ast) {
  var extendNodes = [];
  ast.traverseByType('extend', function (node) {
    return extendNodes.push(node);
  });

  return _fp2.default.compose(_fp2.default.reduce(function (result, key) {
    result[key] = true; // mark extend classes as true
    return result;
  }, {}), _fp2.default.map(_fp2.default.compose(_fp2.default.get('content'), _fp2.default.find({ type: 'ident' }), _fp2.default.get('content'), _fp2.default.find({ type: 'class' }), _fp2.default.get('content'), _fp2.default.find({ type: 'selector' }), _fp2.default.get('content'))))(extendNodes);
};

/*
   mutates ast by removing instances of :global
 */
var eliminateGlobals = exports.eliminateGlobals = function eliminateGlobals(ast) {
  ast.traverse(function (node, index, parent) {
    if (node.type === 'ruleset') {
      if (_fp2.default.compose(_fp2.default.negate(_fp2.default.isEmpty), _fp2.default.find({ type: 'ident', content: 'global' }), _fp2.default.get('content'), _fp2.default.find({ type: 'pseudoClass' }), _fp2.default.get('content'), _fp2.default.find({ type: 'selector' }), _fp2.default.get('content'))(node)) {
        parent.removeChild(index);
      }
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jb3JlL3RyYXZlcnNhbFV0aWxzLmpzIl0sIm5hbWVzIjpbImdldFJlZ3VsYXJDbGFzc2VzTWFwIiwiYXN0IiwicnVsZVNldHMiLCJ0cmF2ZXJzZUJ5VHlwZSIsInB1c2giLCJub2RlIiwiY29tcG9zZSIsInJlZHVjZSIsInJlc3VsdCIsImtleSIsIm1hcCIsImZpbHRlciIsInR5cGUiLCJmbGF0TWFwIiwiZ2V0Q29tcG9zZXNDbGFzc2VzTWFwIiwiZGVjbGFyYXRpb25zIiwiZ2V0IiwiZmluZCIsInJlamVjdCIsImNvbnRlbnQiLCJnZXRFeHRlbmRDbGFzc2VzTWFwIiwiZXh0ZW5kTm9kZXMiLCJlbGltaW5hdGVHbG9iYWxzIiwidHJhdmVyc2UiLCJpbmRleCIsInBhcmVudCIsIm5lZ2F0ZSIsImlzRW1wdHkiLCJyZW1vdmVDaGlsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBOzs7Ozs7QUFRTyxJQUFNQSxzREFBdUIsU0FBdkJBLG9CQUF1QixDQUFDQyxHQUFELEVBQWlDO0FBQ25FLE1BQU1DLFdBQTRCLEVBQWxDO0FBQ0FELE1BQUlFLGNBQUosQ0FBbUIsU0FBbkIsRUFBOEI7QUFBQSxXQUFRRCxTQUFTRSxJQUFULENBQWNDLElBQWQsQ0FBUjtBQUFBLEdBQTlCOztBQUVBLFNBQU8sYUFBR0MsT0FBSCxDQUNMLGFBQUdDLE1BQUgsQ0FBVSxVQUFDQyxNQUFELEVBQVNDLEdBQVQsRUFBaUI7QUFDekJELFdBQU9DLEdBQVAsSUFBYyxLQUFkLENBRHlCLENBQ0o7QUFDckIsV0FBT0QsTUFBUDtBQUNELEdBSEQsRUFHRyxFQUhILENBREssRUFLTCxhQUFHRSxHQUFILENBQU8sU0FBUCxDQUxLLEVBTUwsYUFBR0MsTUFBSCxDQUFVLEVBQUVDLE1BQU0sT0FBUixFQUFWLENBTkssRUFPTCxhQUFHQyxPQUFILENBQVcsU0FBWCxDQVBLLEVBUUwsYUFBR0YsTUFBSCxDQUFVLEVBQUVDLE1BQU0sT0FBUixFQUFWLENBUkssRUFTTCxhQUFHQyxP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LENBQVA7QUFlRCxDQW5CTTs7QUFxQlA7OztBQUdPLElBQU1DLDhDQUFtQixTQUFuQkEsZ0JBQW1CLENBQUNyQixHQUFELEVBQW1CO0FBQ2pEQSxNQUFJc0IsUUFBSixDQUFhLFVBQUNsQixJQUFELEVBQU9tQixLQUFQLEVBQWNDLE1BQWQsRUFBeUI7QUFDcEMsUUFBSXBCLEtBQUtPLElBQUwsS0FBYyxTQUFsQixFQUE2QjtBQUMzQixVQUNFLGFBQUdOLE9BQUgsQ0FDRSxhQUFHb0IsTUFBSCxDQUFVLGFBQUdDLE9BQWIsQ0FERixFQUVFLGFBQUdWLElBQUgsQ0FBUSxFQUFFTCxNQUFNLE9BQVIsRUFBaUJPLFNBQVMsUUFBMUIsRUFBUixDQUZGLEVBR0UsYUFBR0gsR0FBSCxDQUFPLFNBQVAsQ0FIRixFQUlFLGFBQUdDLElBQUgsQ0FBUSxFQUFFTCxNQUFNLGFBQVIsRUFBUixDQUpGLEVBS0UsYUFBR0ksR0FBSCxDQUFPLFNBQVAsQ0FMRixFQU1FLGFBQUdDLElBQUgsQ0FBUSxFQUFFTCxNQUFNLFVBQVIsRUFBUixDQU5GLEVBT0UsYUFBR0ksR0FBSCxDQUFPLFNBQVAsQ0FQRixFQVFFWCxJQVJGLENBREYsRUFVRTtBQUNBb0IsZUFBT0csV0FBUCxDQUFtQkosS0FBbkI7QUFDRDtBQUNGO0FBQ0YsR0FoQkQ7QUFpQkQsQ0FsQk0iLCJmaWxlIjoidHJhdmVyc2FsVXRpbHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmltcG9ydCBmcCBmcm9tICdsb2Rhc2gvZnAnO1xuXG5pbXBvcnQgdHlwZSB7IGdBU1ROb2RlIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG50eXBlIGNsYXNzTWFwVHlwZSA9IHtcbiAgW2tleTogc3RyaW5nXTogYm9vbGVhbixcbn1cblxuZXhwb3J0IGNvbnN0IGdldFJlZ3VsYXJDbGFzc2VzTWFwID0gKGFzdDogZ0FTVE5vZGUpOiBjbGFzc01hcFR5cGUgPT4ge1xuICBjb25zdCBydWxlU2V0czogQXJyYXk8Z0FTVE5vZGU+ID0gW107XG4gIGFzdC50cmF2ZXJzZUJ5VHlwZSgncnVsZXNldCcsIG5vZGUgPT4gcnVsZVNldHMucHVzaChub2RlKSk7XG5cbiAgcmV0dXJuIGZwLmNvbXBvc2UoXG4gICAgZnAucmVkdWNlKChyZXN1bHQsIGtleSkgPT4ge1xuICAgICAgcmVzdWx0W2tleV0gPSBmYWxzZTsgLy8gY2xhc3NlcyBoYXZlbid0IGJlZW4gdXNlZFxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LCB7fSksXG4gICAgZnAubWFwKCdjb250ZW50JyksXG4gICAgZnAuZmlsdGVyKHsgdHlwZTogJ2lkZW50JyB9KSxcbiAgICBmcC5mbGF0TWFwKCdjb250ZW50JyksXG4gICAgZnAuZmlsdGVyKHsgdHlwZTogJ2NsYXNzJyB9KSxcbiAgICBmcC5mbGF0TWFwKCdjb250ZW50JyksXG4gICAgZnAuZmlsdGVyKHsgdHlwZTogJ3NlbGVjdG9yJyB9KSxcbiAgICBmcC5mbGF0TWFwKCdjb250ZW50JyksXG4gICkocnVsZVNldHMpO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENvbXBvc2VzQ2xhc3Nlc01hcCA9IChhc3Q6IGdBU1ROb2RlKTogY2xhc3NNYXBUeXBlID0+IHtcbiAgY29uc3QgZGVjbGFyYXRpb25zID0gW107XG4gIGFzdC50cmF2ZXJzZUJ5VHlwZSgnZGVjbGFyYXRpb24nLCBub2RlID0+IGRlY2xhcmF0aW9ucy5wdXNoKG5vZGUpKTtcblxuICByZXR1cm4gZnAuY29tcG9zZShcbiAgICBmcC5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiB7XG4gICAgICByZXN1bHRba2V5XSA9IHRydWU7IC8vIG1hcmsgY29tcG9zZWQgY2xhc3NlcyBhcyB0cnVlXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sIHt9KSxcbiAgICBmcC5mbGF0TWFwKGZwLmNvbXBvc2UoXG4gICAgICBmcC5tYXAoZnAuZ2V0KCdjb250ZW50JykpLFxuICAgICAgZnAuZmlsdGVyKHsgdHlwZTogJ2lkZW50JyB9KSxcbiAgICAgIGZwLmdldCgnY29udGVudCcpLFxuICAgICAgZnAuZmluZCh7IHR5cGU6ICd2YWx1ZScgfSksXG4gICAgICBmcC5nZXQoJ2NvbnRlbnQnKSxcbiAgICApKSxcbiAgICAvKlxuICAgICAgIHJlamVjdCBjbGFzc2VzIGNvbXBvc2luZyBmcm9tIG90aGVyIGZpbGVzXG4gICAgICAgZWcuXG4gICAgICAgLmZvbyB7XG4gICAgICAgY29tcG9zZXM6IC5iYXIgZnJvbSAnLi9vdGhlckZpbGUnO1xuICAgICAgIH1cbiAgICAgKi9cbiAgICBmcC5yZWplY3QoZnAuY29tcG9zZShcbiAgICAgIGZwLmZpbmQoeyB0eXBlOiAnaWRlbnQnLCBjb250ZW50OiAnZnJvbScgfSksXG4gICAgICBmcC5nZXQoJ2NvbnRlbnQnKSxcbiAgICAgIGZwLmZpbmQoeyB0eXBlOiAndmFsdWUnIH0pLFxuICAgICAgZnAuZ2V0KCdjb250ZW50JyksXG4gICAgKSksXG4gICAgZnAuZmlsdGVyKGZwLmNvbXBvc2UoXG4gICAgICBmcC5maW5kKHsgdHlwZTogJ2lkZW50JywgY29udGVudDogJ2NvbXBvc2VzJyB9KSxcbiAgICAgIGZwLmdldCgnY29udGVudCcpLFxuICAgICAgZnAuZmluZCh7IHR5cGU6ICdwcm9wZXJ0eScgfSksXG4gICAgICBmcC5nZXQoJ2NvbnRlbnQnKSxcbiAgICApKSxcbiAgKShkZWNsYXJhdGlvbnMpO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEV4dGVuZENsYXNzZXNNYXAgPSAoYXN0OiBnQVNUTm9kZSk6IGNsYXNzTWFwVHlwZSA9PiB7XG4gIGNvbnN0IGV4dGVuZE5vZGVzID0gW107XG4gIGFzdC50cmF2ZXJzZUJ5VHlwZSgnZXh0ZW5kJywgbm9kZSA9PiBleHRlbmROb2Rlcy5wdXNoKG5vZGUpKTtcblxuICByZXR1cm4gZnAuY29tcG9zZShcbiAgICBmcC5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiB7XG4gICAgICByZXN1bHRba2V5XSA9IHRydWU7IC8vIG1hcmsgZXh0ZW5kIGNsYXNzZXMgYXMgdHJ1ZVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LCB7fSksXG4gICAgZnAubWFwKGZwLmNvbXBvc2UoXG4gICAgICBmcC5nZXQoJ2NvbnRlbnQnKSxcbiAgICAgIGZwLmZpbmQoeyB0eXBlOiAnaWRlbnQnIH0pLFxuICAgICAgZnAuZ2V0KCdjb250ZW50JyksXG4gICAgICBmcC5maW5kKHsgdHlwZTogJ2NsYXNzJyB9KSxcbiAgICAgIGZwLmdldCgnY29udGVudCcpLFxuICAgICAgZnAuZmluZCh7IHR5cGU6ICdzZWxlY3RvcicgfSksXG4gICAgICBmcC5nZXQoJ2NvbnRlbnQnKSxcbiAgICApKSxcbiAgKShleHRlbmROb2Rlcyk7XG59O1xuXG4vKlxuICAgbXV0YXRlcyBhc3QgYnkgcmVtb3ZpbmcgaW5zdGFuY2VzIG9mIDpnbG9iYWxcbiAqL1xuZXhwb3J0IGNvbnN0IGVsaW1pbmF0ZUdsb2JhbHMgPSAoYXN0OiBnQVNUTm9kZSkgPT4ge1xuICBhc3QudHJhdmVyc2UoKG5vZGUsIGluZGV4LCBwYXJlbnQpID0+IHtcbiAgICBpZiAobm9kZS50eXBlID09PSAncnVsZXNldCcpIHtcbiAgICAgIGlmIChcbiAgICAgICAgZnAuY29tcG9zZShcbiAgICAgICAgICBmcC5uZWdhdGUoZnAuaXNFbXB0eSksXG4gICAgICAgICAgZnAuZmluZCh7IHR5cGU6ICdpZGVudCcsIGNvbnRlbnQ6ICdnbG9iYWwnIH0pLFxuICAgICAgICAgIGZwLmdldCgnY29udGVudCcpLFxuICAgICAgICAgIGZwLmZpbmQoeyB0eXBlOiAncHNldWRvQ2xhc3MnIH0pLFxuICAgICAgICAgIGZwLmdldCgnY29udGVudCcpLFxuICAgICAgICAgIGZwLmZpbmQoeyB0eXBlOiAnc2VsZWN0b3InIH0pLFxuICAgICAgICAgIGZwLmdldCgnY29udGVudCcpLFxuICAgICAgICApKG5vZGUpXG4gICAgICApIHtcbiAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKGluZGV4KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbiJdfQ==